<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Attendace+</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
    integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>
</head>

<body>
  <div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
    <!--<img src="image2.png" alt="logotec" class="img-logo">-->
    <div class="img-logo"></div>
    <p class="text-salon">Salon 4202</p>
    <p class="text-materia">Iot Grupo 13</p>
    <p class="text-horario">7:00 - 13:00</p>
    <p class="text-conf">Configuración</p>

    <div class="block-switch1">
      <p class="text2">Iluminación Automática</p>
      <label class="switch">
        <input type="checkbox">
        <span class="slider round"></span>
      </label>
    </div>

    <div class="block-switch2">
      <p class="text2">Ventilación Automática</p>
      <label class="switch">
        <input type="checkbox">
        <span class="slider round"></span>
      </label>
    </div>


    <div class="controles-luz">
      <p class="text-nose">Nivel de luz:</p>
      <p class="text-dato">12%</p>
      <div class="progress pr-pos">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p class="text-luces">Luces:</p>
      <label class="switch switch-pos2">
        <input type="checkbox">
        <span class="slider round"></span>
      </label>
    </div>

    <div class="controles-ventilador">
      <p class="text-nose">Temperatura:</p>
      <p class="text-dato">12°C</p>
      <div class="progress pr-pos">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <p class="text-luces">Ventiladores:</p>
      <label class="switch switch-pos2">
        <input type="checkbox">
        <span class="slider round"></span>
      </label>
    </div>



  </div>
  <button class="btn btn-success" onclick="openNav()">
    <h2>☰</h2>
  </button>
  <div id="main" class="container">
    <h1 style="color: black;"> Attendance+</h1>
    <table class="table">
      <thead>
        <th>Numero de estudiante</th> <!-- Table Headers -->
        <th>Nombre</th> <!-- Table Headers -->
        <th>Apellido</th>
        <th>Matricula</th>
        <th>RFID</th>
        <th>Asisitió</th>
      </thead>
      <tbody id="tbody1">
      </tbody>
    </table>
  </div>
</body>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/9.5.0/firebase-database.js'
  // https://firebase.google.com/docs/web/setup#available-libraries

  const firebaseConfig = {
    apiKey: "AIzaSyB3MslqrUfPw56I3Oxh9piHjS_4bFbLA44",
    authDomain: "salon-inteligente-65de7.firebaseapp.com",
    databaseURL: "https://salon-inteligente-65de7-default-rtdb.firebaseio.com",
    projectId: "salon-inteligente-65de7",
    storageBucket: "salon-inteligente-65de7.appspot.com",
    messagingSenderId: "337142710525",
    appId: "1:337142710525:web:366f2c551de767b108fe94"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  function SelectAllData() {
    firebase.database().ref('estudiantes').on('value',
      function (AllRecords) {
        document.getElementById('tbody1').innerHTML = " ";
        count = 0;
        AllRecords.forEach(
          function (CurrentRecord) {
            var nombre = CurrentRecord.val().nombre;
            var apellido = CurrentRecord.val().apellido;
            var rfid = CurrentRecord.val().rfid;
            var matricula = CurrentRecord.val().matricula;
            console.log(nombre, apellido, rfid, matricula, "Hello world")
            AddItemsToTable(nombre, apellido, rfid, matricula);
          }
        )
        UpdateCheckbox();
      })
    //firebase.database().ref().
  }

  function UpdateCheckbox() {
    firebase.database().ref('lista_de_asistencia/1/lista_alumnos').on('value',
      function (AllRecords) {
        var index = 0;
        console.log(AllRecords.val());
        var keys = Object.keys(AllRecords.val());
        AllRecords.forEach(
          function (currentRecord) {
            var asistencia = currentRecord.val().estado_asistencia;
            document.getElementById(keys[index]).checked = asistencia;
            index++;
          }
        );
      })
  }

  document.addEventListener('DOMContentLoaded', function () {
    firebase.database().ref('salon').once('value',
      function (AllRecords) {
        AllRecords.forEach(
          function (CurrentRecord) {
            var salon = AllRecords.val();
            var autoLuz = CurrentRecord.val().autoLuz;
            var autoVentilador = CurrentRecord.val().autoVentilador;
            var estadoLuces = CurrentRecord.val().estadoLuces;
            var estadoVentilador = CurrentRecord.val().estadoVentilador;
            var nivelLuz = CurrentRecord.val().nivelLuz;
            var temperatura = CurrentRecord.val().temperatura;
            console.log(Object.keys(salon)[0], autoLuz, autoVentilador, estadoLuces, estadoVentilador, nivelLuz, temperatura)
            var salon = document.getElementById('salon')
            var autoLuz = document.getElementById('autoLuz');
            var autoVentilador = document.getElementById('autoVentilador');
            var estadoLuces = document.getElementById('estadoLuces');
            var estadoVentilador = document.getElementById('estadoVentilador');
            var nivelLuz = document.getElementById('nivelLuz');
            var temperatura = document.getElementById('temperatura');
            //salon.innerHTML = Object.keys(salon)[0];
          }
        )
      })
  }, false);

  var count = 0;
  function AddItemsToTable(nombre, apellido, rfid, matricula) {
    var tbody = document.getElementById('tbody1');
    var trow = document.createElement('tr');
    var td1 = document.createElement('td');
    var td2 = document.createElement('td');
    var td3 = document.createElement('td');
    var td4 = document.createElement('td');
    var td5 = document.createElement('td');
    var tdas = document.createElement('td');
    td1.innerHTML = ++count;
    td2.innerHTML = nombre;
    td3.innerHTML = apellido;
    td4.innerHTML = matricula;
    td5.innerHTML = rfid;
    trow.appendChild(td1);
    trow.appendChild(td2);
    trow.appendChild(td3);
    trow.appendChild(td4);
    trow.appendChild(td5);
    var checkbox = document.createElement('input');
    checkbox.type = "checkbox";
    checkbox.name = "name";
    checkbox.value = "value";

    checkbox.id = matricula;
    checkbox.checked = false;
    checkbox.onclick = function () {
      console.log("Hello there", nombre);
    };
    trow.appendChild(checkbox);
    tbody.appendChild(trow);
  }

  window.onload = SelectAllData;
</script>
<script src="./functions.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
  integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>

</html>
